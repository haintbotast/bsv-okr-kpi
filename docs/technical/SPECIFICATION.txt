================================================================================
CLAUDE CODE PROMPT: LIGHTWEIGHT KPI MANAGEMENT SYSTEM
================================================================================
Version: 1.0
Target Scale: ~30 users
Tech Stack: FastAPI + React + SQLite3 + Docker
Deployment: Single server, self-hosted

================================================================================
PROJECT OVERVIEW
================================================================================

Build a complete, production-ready KPI (Key Performance Indicator) Management 
System optimized for small teams (~30 users). The system must be:

âœ“ Self-contained (SQLite database, local file storage)
âœ“ Easy to deploy (Docker Compose, 2 containers only)
âœ“ Cost-effective (no external services required)
âœ“ Secure (JWT auth, bcrypt passwords, RBAC)
âœ“ User-friendly (modern UI, responsive design)
âœ“ Maintainable (clean code, documented, tested)

TARGET USERS:
- IT Department (5-10 users)
- Management Team (3-5 users)
- Department Staff (15-20 users)

BUSINESS REQUIREMENTS:
1. Manage KPIs by quarters (Q1-Q4) per year
2. Track progress with evidence uploads
3. Support approval workflow
4. Generate reports (PDF export)
5. Role-based access control
6. Comment and collaboration features

================================================================================
ARCHITECTURE DECISIONS (FOR SMALL SCALE)
================================================================================

DATABASE:
âœ“ SQLite3 (NOT PostgreSQL/MySQL)
  - Single file database
  - No separate DB server needed
  - Perfect for <100 users
  - ACID compliant
  - File: /data/database/kpi.db

FILE STORAGE:
âœ“ Local filesystem (NOT S3/MinIO)
  - Direct disk storage
  - Nginx serves static files
  - Path: /data/uploads/
  - Max file size: 50MB per file

BACKGROUND JOBS:
âœ“ APScheduler (NOT Celery/Redis Queue)
  - In-process scheduler
  - No message broker needed
  - Use for: reminders, cleanup, backups

AUTHENTICATION:
âœ“ JWT tokens (access + refresh)
âœ“ bcrypt for password hashing
âœ“ Session timeout: 8 hours

DEPLOYMENT:
âœ“ Docker Compose (2 containers)
  - Backend: FastAPI + Uvicorn
  - Frontend: React + Nginx
âœ“ Single server deployment
âœ“ Reverse proxy: Nginx
âœ“ SSL: Let's Encrypt (manual setup)

================================================================================
TECHNICAL STACK
================================================================================

BACKEND:
- Language: Python 3.11+
- Framework: FastAPI 0.108+
- ORM: SQLAlchemy 2.0+
- Database: SQLite3
- Migration: Alembic
- Auth: python-jose, passlib
- Scheduler: APScheduler 3.10+
- File handling: python-multipart
- PDF generation: reportlab
- Excel export: openpyxl
- Word generation: python-docx

FRONTEND:
- Framework: React 18+
- Build tool: Vite 5+
- Language: JavaScript (or TypeScript if preferred)
- Styling: Tailwind CSS 3+
- UI Components: shadcn/ui (optional)
- State Management: React Context + hooks
- HTTP Client: Axios
- Routing: React Router v6
- Forms: React Hook Form
- Charts: Recharts or Chart.js
- Date handling: date-fns
- File preview: react-pdf, react-file-viewer

DEPLOYMENT:
- Containerization: Docker + Docker Compose
- Web Server: Nginx
- Process Manager: Uvicorn (for FastAPI)
- Reverse Proxy: Nginx (for routing)

================================================================================
DATABASE SCHEMA (SQLite)
================================================================================

TABLES TO IMPLEMENT:

1. users
   - id: INTEGER PRIMARY KEY AUTOINCREMENT
   - email: TEXT UNIQUE NOT NULL
   - username: TEXT UNIQUE NOT NULL
   - password_hash: TEXT NOT NULL
   - full_name: TEXT
   - role: TEXT NOT NULL (admin, manager, employee)
   - department: TEXT
   - position: TEXT
   - is_active: BOOLEAN DEFAULT TRUE
   - created_at: TIMESTAMP
   - updated_at: TIMESTAMP

2. kpi_templates
   - id: INTEGER PRIMARY KEY
   - name: TEXT NOT NULL
   - description: TEXT
   - category: TEXT (mission, goal, task)
   - role: TEXT (admin, manager, employee)
   - measurement_method: TEXT
   - target_type: TEXT (percentage, number, boolean)
   - created_by: INTEGER FOREIGN KEY -> users.id
   - created_at: TIMESTAMP
   - is_active: BOOLEAN

3. kpis
   - id: INTEGER PRIMARY KEY
   - user_id: INTEGER FOREIGN KEY -> users.id
   - template_id: INTEGER FOREIGN KEY -> kpi_templates.id (nullable)
   - year: INTEGER NOT NULL
   - quarter: TEXT NOT NULL (Q1, Q2, Q3, Q4)
   - title: TEXT NOT NULL
   - description: TEXT
   - category: TEXT
   - target_value: TEXT
   - current_value: TEXT
   - progress_percentage: REAL
   - measurement_method: TEXT
   - status: TEXT (draft, submitted, approved, rejected)
   - created_at: TIMESTAMP
   - updated_at: TIMESTAMP
   - submitted_at: TIMESTAMP
   - approved_at: TIMESTAMP
   - approved_by: INTEGER FOREIGN KEY -> users.id

4. kpi_evidence
   - id: INTEGER PRIMARY KEY
   - kpi_id: INTEGER FOREIGN KEY -> kpis.id
   - file_name: TEXT NOT NULL
   - file_path: TEXT NOT NULL
   - file_type: TEXT
   - file_size: INTEGER
   - uploaded_by: INTEGER FOREIGN KEY -> users.id
   - uploaded_at: TIMESTAMP
   - description: TEXT

5. kpi_comments
   - id: INTEGER PRIMARY KEY
   - kpi_id: INTEGER FOREIGN KEY -> kpis.id
   - user_id: INTEGER FOREIGN KEY -> users.id
   - comment: TEXT NOT NULL
   - created_at: TIMESTAMP
   - updated_at: TIMESTAMP

6. kpi_history
   - id: INTEGER PRIMARY KEY
   - kpi_id: INTEGER FOREIGN KEY -> kpis.id
   - user_id: INTEGER FOREIGN KEY -> users.id
   - action: TEXT (created, updated, submitted, approved, rejected)
   - old_value: TEXT (JSON)
   - new_value: TEXT (JSON)
   - created_at: TIMESTAMP

7. notifications
   - id: INTEGER PRIMARY KEY
   - user_id: INTEGER FOREIGN KEY -> users.id
   - title: TEXT
   - message: TEXT
   - type: TEXT (info, warning, success, error)
   - is_read: BOOLEAN DEFAULT FALSE
   - link: TEXT
   - created_at: TIMESTAMP

8. system_settings
   - key: TEXT PRIMARY KEY
   - value: TEXT
   - description: TEXT
   - updated_at: TIMESTAMP

================================================================================
FEATURES TO IMPLEMENT
================================================================================

PHASE 1: CORE INFRASTRUCTURE (Week 1)
--------------------------------------
Backend:
â–¡ Project setup with FastAPI
â–¡ SQLite database configuration
â–¡ SQLAlchemy models for all tables
â–¡ Alembic migrations setup
â–¡ Database initialization script
â–¡ JWT authentication system
  - Login endpoint
  - Token refresh endpoint
  - Password reset (email optional)
â–¡ User CRUD operations
â–¡ Role-based access control (RBAC)
â–¡ Error handling middleware
â–¡ CORS configuration
â–¡ Logging setup

Frontend:
â–¡ React project setup with Vite
â–¡ Tailwind CSS configuration
â–¡ Folder structure
  - /src/components (reusable components)
  - /src/pages (route pages)
  - /src/services (API calls)
  - /src/utils (helpers)
  - /src/contexts (global state)
â–¡ Authentication context
â–¡ Login page
â–¡ Protected routes
â–¡ Layout components (Header, Sidebar, Footer)
â–¡ Basic styling and theme

Docker:
â–¡ Backend Dockerfile
â–¡ Frontend Dockerfile (multi-stage)
â–¡ Docker Compose file
â–¡ Nginx configuration
â–¡ Environment variables setup
â–¡ Volume mounts for data persistence

PHASE 2: KPI MANAGEMENT (Week 2)
---------------------------------
Backend:
â–¡ KPI templates CRUD
â–¡ KPI CRUD endpoints
â–¡ KPI filtering (by user, year, quarter, status)
â–¡ KPI statistics endpoint
â–¡ Validation logic
  - Business rules enforcement
  - Data integrity checks
â–¡ Search functionality

Frontend:
â–¡ Dashboard page
  - Overview statistics
  - Recent KPIs
  - Pending approvals (for managers)
  - Charts (progress by quarter)
â–¡ KPI list page
  - Filters (year, quarter, status, user)
  - Search
  - Pagination
  - Sort options
â–¡ KPI create/edit form
  - Template selection
  - Dynamic form fields
  - Validation
  - Auto-save (optional)
â–¡ KPI detail view
  - Full information display
  - Timeline/history
  - Related evidence
  - Comments section

PHASE 3: FILE MANAGEMENT (Week 3)
----------------------------------
Backend:
â–¡ File upload endpoint
  - Validate file types (pdf, doc, docx, xls, xlsx, jpg, png)
  - Validate file size (max 50MB)
  - Generate unique filenames
  - Store in /data/uploads/
â–¡ File download endpoint
â–¡ File delete endpoint
â–¡ File listing by KPI
â–¡ Security checks (ownership validation)

Frontend:
â–¡ File upload component
  - Drag & drop support
  - Multiple file upload
  - Progress indicator
  - Preview before upload
â–¡ File list component
  - Thumbnail view
  - Download button
  - Delete button (with confirmation)
â–¡ File viewer component
  - PDF preview (react-pdf)
  - Image preview
  - Document preview (iframe for Office files)

PHASE 4: WORKFLOW & COLLABORATION (Week 4)
-------------------------------------------
Backend:
â–¡ Comment CRUD endpoints
â–¡ Comment notifications
â–¡ KPI approval workflow
  - Submit for approval
  - Approve endpoint
  - Reject endpoint (with reason)
â–¡ Email notifications (optional)
  - SMTP configuration
  - Template system
  - Send on: submission, approval, rejection
â–¡ Activity history tracking
â–¡ Notification system
  - Create notification
  - Mark as read
  - List notifications

Frontend:
â–¡ Comment section component
  - Add comment form
  - Comment list
  - Real-time updates (polling every 30s)
â–¡ Approval interface (for managers)
  - Pending list
  - Approve/reject buttons
  - Reason input for rejection
â–¡ Notification center
  - Dropdown in header
  - Unread count badge
  - Mark all as read
  - Link to related KPI
â–¡ Activity timeline
  - Show KPI history
  - Visual timeline UI

PHASE 5: REPORTING & ANALYTICS (Week 5)
----------------------------------------
Backend:
â–¡ Report generation endpoints
  - User report (all KPIs for user)
  - Department report
  - Quarterly report
  - Annual report
â–¡ PDF export (reportlab)
  - Header with logo
  - KPI details table
  - Charts (if possible)
  - Evidence list
â–¡ Excel export (openpyxl)
  - Multiple sheets
  - Formatted cells
  - Charts
â–¡ Analytics endpoints
  - KPI completion rate
  - Average progress
  - Department comparison
  - Quarter-over-quarter growth

Frontend:
â–¡ Reports page
  - Report type selection
  - Filter options
  - Generate button
  - Download link
â–¡ Analytics dashboard
  - Summary cards
  - Charts (bar, line, pie)
  - Filters (year, quarter, department)
  - Export to Excel
â–¡ Print-friendly views
  - CSS for printing
  - Remove navigation
  - Optimize layout

PHASE 6: ADMIN FEATURES (Week 6)
---------------------------------
Backend:
â–¡ User management endpoints
  - List all users
  - Create user
  - Update user
  - Deactivate user
  - Reset password
â–¡ Template management
  - CRUD for templates
  - Assign templates to roles
â–¡ System settings
  - Get/update settings
  - Configuration options
â–¡ Backup endpoint
  - Manual backup trigger
  - List backups
  - Restore backup
â–¡ Audit log
  - Track all actions
  - Filter by user, date, action

Frontend:
â–¡ User management page
  - User list table
  - Add/edit user form
  - Bulk actions
  - Role assignment
â–¡ Template management page
  - Template list
  - Template editor
  - Preview
â–¡ System settings page
  - Configuration forms
  - Save settings
â–¡ Backup management
  - Backup list
  - Download backup
  - Restore interface
â–¡ Audit log viewer
  - Table with filters
  - Search
  - Export to CSV

PHASE 7: OPTIMIZATION & POLISH (Week 7-8)
------------------------------------------
Backend:
â–¡ Query optimization
  - Add indexes
  - Optimize N+1 queries
  - Pagination improvements
â–¡ Caching (if needed)
  - Cache frequently accessed data
â–¡ Background tasks with APScheduler
  - Daily backup at 2 AM
  - Cleanup old notifications
  - Send reminder emails
â–¡ API documentation (Swagger UI)
â–¡ Unit tests (pytest)
  - Test auth
  - Test CRUD operations
  - Test business logic
â–¡ Load testing (basic)
  - Test with 30 concurrent users

Frontend:
â–¡ Performance optimization
  - Code splitting
  - Lazy loading
  - Image optimization
â–¡ Responsive design
  - Mobile-friendly
  - Tablet support
â–¡ Accessibility (WCAG 2.1)
  - Keyboard navigation
  - Screen reader support
  - ARIA labels
â–¡ Error boundaries
â–¡ Loading states
â–¡ Empty states
â–¡ Success/error messages (toast notifications)
â–¡ User guide/documentation
  - Help tooltips
  - Getting started guide
  - FAQ page

Testing:
â–¡ End-to-end tests (Playwright or Cypress)
  - Login flow
  - Create KPI flow
  - Approval flow
  - File upload flow
â–¡ Browser compatibility testing
â–¡ User acceptance testing

================================================================================
PROJECT STRUCTURE
================================================================================

kpi-system/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ alembic.ini
â”‚   â”œâ”€â”€ pytest.ini
â”‚   â”‚
â”‚   â”œâ”€â”€ alembic/
â”‚   â”‚   â”œâ”€â”€ env.py
â”‚   â”‚   â””â”€â”€ versions/
â”‚   â”‚       â””â”€â”€ (migration files)
â”‚   â”‚
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py                    # FastAPI app initialization
â”‚   â”‚   â”œâ”€â”€ config.py                  # Configuration settings
â”‚   â”‚   â”œâ”€â”€ database.py                # Database connection
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/                    # SQLAlchemy models
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ kpi.py
â”‚   â”‚   â”‚   â”œâ”€â”€ template.py
â”‚   â”‚   â”‚   â”œâ”€â”€ evidence.py
â”‚   â”‚   â”‚   â”œâ”€â”€ comment.py
â”‚   â”‚   â”‚   â””â”€â”€ notification.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ schemas/                   # Pydantic schemas
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ kpi.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                       # API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ deps.py                # Dependencies (auth, db)
â”‚   â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚       â”œâ”€â”€ users.py
â”‚   â”‚   â”‚       â”œâ”€â”€ kpis.py
â”‚   â”‚   â”‚       â”œâ”€â”€ templates.py
â”‚   â”‚   â”‚       â”œâ”€â”€ files.py
â”‚   â”‚   â”‚       â”œâ”€â”€ comments.py
â”‚   â”‚   â”‚       â”œâ”€â”€ reports.py
â”‚   â”‚   â”‚       â””â”€â”€ admin.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ crud/                      # CRUD operations
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”‚   â”œâ”€â”€ kpi.py
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/                  # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â”œâ”€â”€ file_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ report_service.py
â”‚   â”‚   â”‚   â”œâ”€â”€ notification_service.py
â”‚   â”‚   â”‚   â””â”€â”€ scheduler.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/                     # Utilities
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ security.py
â”‚   â”‚       â”œâ”€â”€ email.py
â”‚   â”‚       â””â”€â”€ helpers.py
â”‚   â”‚
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ conftest.py
â”‚       â”œâ”€â”€ test_auth.py
â”‚       â””â”€â”€ test_kpis.py
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ postcss.config.js
â”‚   â”œâ”€â”€ index.html
â”‚   â”‚
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”‚
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.jsx                   # Entry point
â”‚       â”œâ”€â”€ App.jsx                    # Root component
â”‚       â”‚
â”‚       â”œâ”€â”€ components/                # Reusable components
â”‚       â”‚   â”œâ”€â”€ layout/
â”‚       â”‚   â”‚   â”œâ”€â”€ Header.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Footer.jsx
â”‚       â”‚   â”‚   â””â”€â”€ Layout.jsx
â”‚       â”‚   â”œâ”€â”€ common/
â”‚       â”‚   â”‚   â”œâ”€â”€ Button.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Input.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Modal.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Table.jsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Loader.jsx
â”‚       â”‚   â”‚   â””â”€â”€ Toast.jsx
â”‚       â”‚   â””â”€â”€ features/
â”‚       â”‚       â”œâ”€â”€ KPICard.jsx
â”‚       â”‚       â”œâ”€â”€ KPIForm.jsx
â”‚       â”‚       â”œâ”€â”€ FileUpload.jsx
â”‚       â”‚       â”œâ”€â”€ CommentSection.jsx
â”‚       â”‚       â”œâ”€â”€ ApprovalButton.jsx
â”‚       â”‚       â””â”€â”€ Chart.jsx
â”‚       â”‚
â”‚       â”œâ”€â”€ pages/                     # Route pages
â”‚       â”‚   â”œâ”€â”€ auth/
â”‚       â”‚   â”‚   â”œâ”€â”€ Login.jsx
â”‚       â”‚   â”‚   â””â”€â”€ ForgotPassword.jsx
â”‚       â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚       â”‚   â”œâ”€â”€ KPIList.jsx
â”‚       â”‚   â”œâ”€â”€ KPIDetail.jsx
â”‚       â”‚   â”œâ”€â”€ KPICreate.jsx
â”‚       â”‚   â”œâ”€â”€ Reports.jsx
â”‚       â”‚   â”œâ”€â”€ Analytics.jsx
â”‚       â”‚   â”œâ”€â”€ Profile.jsx
â”‚       â”‚   â””â”€â”€ admin/
â”‚       â”‚       â”œâ”€â”€ Users.jsx
â”‚       â”‚       â”œâ”€â”€ Templates.jsx
â”‚       â”‚       â””â”€â”€ Settings.jsx
â”‚       â”‚
â”‚       â”œâ”€â”€ services/                  # API services
â”‚       â”‚   â”œâ”€â”€ api.js                 # Axios config
â”‚       â”‚   â”œâ”€â”€ authService.js
â”‚       â”‚   â”œâ”€â”€ kpiService.js
â”‚       â”‚   â”œâ”€â”€ fileService.js
â”‚       â”‚   â”œâ”€â”€ commentService.js
â”‚       â”‚   â””â”€â”€ reportService.js
â”‚       â”‚
â”‚       â”œâ”€â”€ contexts/                  # React contexts
â”‚       â”‚   â”œâ”€â”€ AuthContext.jsx
â”‚       â”‚   â”œâ”€â”€ NotificationContext.jsx
â”‚       â”‚   â””â”€â”€ ThemeContext.jsx
â”‚       â”‚
â”‚       â”œâ”€â”€ hooks/                     # Custom hooks
â”‚       â”‚   â”œâ”€â”€ useAuth.js
â”‚       â”‚   â”œâ”€â”€ useKPI.js
â”‚       â”‚   â””â”€â”€ useDebounce.js
â”‚       â”‚
â”‚       â”œâ”€â”€ utils/                     # Utilities
â”‚       â”‚   â”œâ”€â”€ constants.js
â”‚       â”‚   â”œâ”€â”€ helpers.js
â”‚       â”‚   â””â”€â”€ validators.js
â”‚       â”‚
â”‚       â””â”€â”€ styles/                    # Global styles
â”‚           â””â”€â”€ index.css
â”‚
â”œâ”€â”€ data/                              # Persistent data (auto-created)
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ kpi.db
â”‚   â”œâ”€â”€ uploads/
â”‚   â””â”€â”€ backups/
â”‚
â”œâ”€â”€ scripts/                           # Helper scripts
â”‚   â”œâ”€â”€ init_db.py                     # Initialize database
â”‚   â”œâ”€â”€ seed_data.py                   # Seed sample data
â”‚   â”œâ”€â”€ backup.sh                      # Manual backup
â”‚   â””â”€â”€ deploy.sh                      # Deployment script
â”‚
â”œâ”€â”€ docker-compose.yml                 # Docker orchestration
â”œâ”€â”€ .env.example                       # Environment template
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md                          # Documentation

================================================================================
DOCKER COMPOSE CONFIGURATION
================================================================================

version: '3.8'

services:
  backend:
    build: ./backend
    container_name: kpi-backend
    ports:
      - "8000:8000"
    volumes:
      - ./data/database:/data/database
      - ./data/uploads:/data/uploads
      - ./data/backups:/data/backups
    environment:
      - DATABASE_URL=sqlite:////data/database/kpi.db
      - SECRET_KEY=${SECRET_KEY}
      - UPLOAD_DIR=/data/uploads
      - BACKUP_DIR=/data/backups
      - CORS_ORIGINS=${CORS_ORIGINS}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  frontend:
    build: ./frontend
    container_name: kpi-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    volumes:
      - ./data/uploads:/data/uploads:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  database:
  uploads:
  backups:

================================================================================
ENVIRONMENT VARIABLES (.env)
================================================================================

# Application
APP_NAME=KPI Management System
APP_VERSION=1.0.0
ENVIRONMENT=production

# Security
SECRET_KEY=your-super-secret-key-min-32-chars-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=480
REFRESH_TOKEN_EXPIRE_DAYS=7

# Database
DATABASE_URL=sqlite:////data/database/kpi.db

# File Storage
UPLOAD_DIR=/data/uploads
MAX_UPLOAD_SIZE=52428800
ALLOWED_EXTENSIONS=pdf,doc,docx,xls,xlsx,ppt,pptx,jpg,jpeg,png,gif

# Backup
BACKUP_DIR=/data/backups
BACKUP_RETENTION_DAYS=30
AUTO_BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *

# CORS
CORS_ORIGINS=http://localhost,http://localhost:3000,http://your-domain.com

# Email (Optional)
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=noreply@your-domain.com

# Logging
LOG_LEVEL=INFO
LOG_FILE=/data/logs/app.log

================================================================================
KEY CONFIGURATION FILES
================================================================================

BACKEND REQUIREMENTS.TXT:
```
fastapi==0.108.0
uvicorn[standard]==0.25.0
sqlalchemy==2.0.25
alembic==1.13.0
pydantic==2.5.3
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
python-dateutil==2.8.2
apscheduler==3.10.4
reportlab==4.0.7
openpyxl==3.1.2
python-docx==1.1.0
pillow==10.1.0
aiofiles==23.2.1
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2
```

FRONTEND PACKAGE.JSON:
```json
{
  "name": "kpi-frontend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint src"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.1",
    "axios": "^1.6.2",
    "react-hook-form": "^7.49.2",
    "date-fns": "^3.0.0",
    "recharts": "^2.10.3",
    "react-pdf": "^7.6.0",
    "lucide-react": "^0.294.0",
    "clsx": "^2.0.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.1",
    "vite": "^5.0.8",
    "tailwindcss": "^3.3.6",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "eslint": "^8.55.0"
  }
}
```

NGINX.CONF:
```nginx
server {
    listen 80;
    server_name localhost;
    client_max_body_size 50M;

    # Frontend
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # File uploads/downloads
    location /uploads {
        alias /data/uploads;
        autoindex off;
        
        # Security headers
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options SAMEORIGIN;
        add_header X-XSS-Protection "1; mode=block";
    }

    # Health check
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

================================================================================
SECURITY BEST PRACTICES
================================================================================

1. AUTHENTICATION:
   â–¡ Use strong JWT secret (min 32 characters)
   â–¡ Implement token refresh mechanism
   â–¡ Set reasonable token expiry times
   â–¡ Store tokens in httpOnly cookies (if possible)
   â–¡ Implement password complexity requirements
   â–¡ Use bcrypt with cost factor 12+

2. AUTHORIZATION:
   â–¡ Implement RBAC consistently
   â–¡ Validate user permissions on every endpoint
   â–¡ Use dependency injection for auth checks
   â–¡ Don't trust client-side role checks

3. FILE UPLOADS:
   â–¡ Validate file types (whitelist approach)
   â–¡ Limit file sizes (50MB max)
   â–¡ Sanitize filenames
   â–¡ Store outside web root
   â–¡ Use unique filenames (UUID)
   â–¡ Scan for malware (optional)

4. DATABASE:
   â–¡ Use parameterized queries (SQLAlchemy does this)
   â–¡ Implement proper indexing
   â–¡ Regular backups
   â–¡ Validate input data
   â–¡ Use foreign key constraints

5. API SECURITY:
   â–¡ Enable CORS properly
   â–¡ Rate limiting (optional for 30 users)
   â–¡ Input validation with Pydantic
   â–¡ SQL injection prevention
   â–¡ XSS prevention
   â–¡ CSRF protection (if using cookies)

6. DEPLOYMENT:
   â–¡ Use HTTPS (Let's Encrypt)
   â–¡ Keep containers updated
   â–¡ Don't expose database port
   â–¡ Use secrets management
   â–¡ Implement logging
   â–¡ Monitor for errors

================================================================================
TESTING STRATEGY
================================================================================

BACKEND TESTS:
â–¡ Unit tests for models
â–¡ Unit tests for CRUD operations
â–¡ Integration tests for API endpoints
â–¡ Authentication tests
â–¡ Authorization tests
â–¡ File upload tests
â–¡ Test coverage > 70%

FRONTEND TESTS:
â–¡ Component unit tests (optional)
â–¡ Integration tests (optional)
â–¡ E2E tests for critical flows:
  - User login
  - Create KPI
  - Submit for approval
  - Approve/reject KPI
  - Upload file
  - Generate report

MANUAL TESTING CHECKLIST:
â–¡ All CRUD operations work
â–¡ Authentication flow complete
â–¡ File upload/download works
â–¡ Approval workflow functions
â–¡ Reports generate correctly
â–¡ Responsive design on mobile
â–¡ Browser compatibility (Chrome, Firefox, Safari, Edge)
â–¡ Error handling works
â–¡ Loading states display
â–¡ Notifications appear

================================================================================
DEPLOYMENT CHECKLIST
================================================================================

PRE-DEPLOYMENT:
â–¡ Create .env file from .env.example
â–¡ Generate strong SECRET_KEY
â–¡ Configure CORS_ORIGINS
â–¡ Set up backup directory
â–¡ Review security settings
â–¡ Test locally with docker-compose

INITIAL DEPLOYMENT:
â–¡ Clone repository to server
â–¡ Install Docker & Docker Compose
â–¡ Copy .env file
â–¡ Run: docker-compose up -d
â–¡ Initialize database: docker-compose exec backend python scripts/init_db.py
â–¡ Create admin user: docker-compose exec backend python scripts/create_admin.py
â–¡ Test access: http://your-server-ip
â–¡ Configure firewall (ports 80, 443)

SSL CERTIFICATE (Let's Encrypt):
â–¡ Install certbot
â–¡ Run: certbot --nginx -d your-domain.com
â–¡ Update nginx.conf for HTTPS
â–¡ Test auto-renewal: certbot renew --dry-run

POST-DEPLOYMENT:
â–¡ Login as admin
â–¡ Create user accounts
â–¡ Create KPI templates
â–¡ Import sample data (if needed)
â–¡ Configure backup schedule
â–¡ Set up monitoring (optional)
â–¡ Document custom configurations
â–¡ Train administrators

================================================================================
MAINTENANCE TASKS
================================================================================

DAILY:
â–¡ Check application logs
â–¡ Monitor disk space
â–¡ Verify backups completed

WEEKLY:
â–¡ Review error logs
â–¡ Check user feedback
â–¡ Update documentation

MONTHLY:
â–¡ Update dependencies (if security patches)
â–¡ Review and clean old backups
â–¡ Analyze usage statistics
â–¡ Performance review

QUARTERLY:
â–¡ Full security audit
â–¡ Update documentation
â–¡ Plan new features
â–¡ User training sessions

================================================================================
PERFORMANCE OPTIMIZATION TIPS
================================================================================

BACKEND:
1. Add database indexes on:
   - users.email
   - users.username
   - kpis.user_id
   - kpis.year, kpis.quarter
   - kpi_evidence.kpi_id
   - kpi_comments.kpi_id

2. Implement pagination:
   - Default: 20 items per page
   - Max: 100 items per page

3. Use eager loading:
   - Load relationships when needed
   - Avoid N+1 query problems

4. Cache static data:
   - Templates
   - System settings
   - User roles (in memory)

5. Optimize file serving:
   - Let Nginx serve files directly
   - Set proper cache headers

FRONTEND:
1. Code splitting:
   - Lazy load routes
   - Lazy load heavy components

2. Image optimization:
   - Compress uploads
   - Use WebP format
   - Lazy load images

3. Caching:
   - Cache API responses (5 min)
   - Cache static assets

4. Bundle optimization:
   - Tree shaking
   - Minification
   - Remove unused code

DATABASE:
1. SQLite optimizations:
   - WAL mode for better concurrency
   - Regular VACUUM
   - Analyze query plans

2. Backup strategy:
   - Daily full backup
   - Keep last 30 days
   - Test restore monthly

================================================================================
TROUBLESHOOTING COMMON ISSUES
================================================================================

ISSUE: Database locked
SOLUTION: Enable WAL mode, reduce concurrent writes

ISSUE: File upload fails
SOLUTION: Check permissions on /data/uploads, verify file size limit

ISSUE: Slow queries
SOLUTION: Add indexes, check for N+1 queries, use EXPLAIN

ISSUE: Memory usage high
SOLUTION: Reduce workers, check for memory leaks, restart containers

ISSUE: Cannot connect to backend
SOLUTION: Check Docker network, verify CORS settings, check firewall

ISSUE: JWT token expired
SOLUTION: Implement token refresh, increase expiry time

ISSUE: PDF generation slow
SOLUTION: Generate async, cache common reports

================================================================================
FUTURE ENHANCEMENTS (Beyond MVP)
================================================================================

NICE TO HAVE (Post-Launch):
â–¡ Real-time notifications (WebSocket)
â–¡ Advanced analytics with BI dashboards
â–¡ Mobile app (React Native)
â–¡ API rate limiting
â–¡ Audit log with detailed tracking
â–¡ Advanced search with ElasticSearch
â–¡ Integration with HR systems
â–¡ Multi-language support
â–¡ Dark mode
â–¡ Custom themes
â–¡ Advanced reporting with custom templates
â–¡ Data export to various formats
â–¡ Import KPIs from Excel
â–¡ Gantt chart view for KPI timelines
â–¡ Calendar integration
â–¡ Automated reminders via email/Slack
â–¡ Performance comparison across departments
â–¡ Goal setting wizard
â–¡ AI-powered insights (optional)

================================================================================
SUCCESS METRICS
================================================================================

TECHNICAL:
â–¡ System uptime: >99%
â–¡ Page load time: <3 seconds
â–¡ API response time: <500ms
â–¡ Database size: <500MB (first year)
â–¡ Zero data loss
â–¡ Zero security breaches

BUSINESS:
â–¡ User adoption: 100% of target users
â–¡ KPI completion rate: >80% on time
â–¡ User satisfaction: >4/5 rating
â–¡ Support tickets: <10 per month
â–¡ Training time: <2 hours per user

================================================================================
FINAL NOTES FOR CLAUDE CODE
================================================================================

BUILD APPROACH:
1. Start with Phase 1 (Core Infrastructure)
2. Get it working end-to-end first
3. Test each feature before moving to next phase
4. Commit frequently with clear messages
5. Document as you go
6. Ask for clarification if requirements are unclear

CODE QUALITY:
â–¡ Follow PEP 8 for Python
â–¡ Follow ESLint rules for JavaScript
â–¡ Write clear comments
â–¡ Use meaningful variable names
â–¡ Keep functions small and focused
â–¡ Handle errors gracefully
â–¡ Log important actions

WHAT TO PRIORITIZE:
1. Security first
2. Core functionality
3. User experience
4. Performance
5. Nice-to-have features

WHAT TO AVOID:
âœ— Over-engineering for scale (it's 30 users!)
âœ— Complex caching strategies
âœ— Microservices architecture
âœ— Message queues (Celery/RabbitMQ)
âœ— External services (unless free)
âœ— Complex CI/CD (keep it simple)

REMEMBER:
- This is a real-world system for ~30 users
- Keep it simple, maintainable, and cost-effective
- Production-ready means reliable, not perfect
- Documentation is as important as code
- Think about the person who will maintain this

================================================================================
READY TO BUILD!
================================================================================

You now have everything needed to build a complete, production-ready KPI 
Management System optimized for small teams. Follow the phases, test 
thoroughly, and don't hesitate to ask questions.

Target timeline: 6-8 weeks for full MVP
Estimated effort: 200-240 hours

Good luck! ðŸš€

================================================================================
QUICK START COMMANDS
================================================================================

# 1. Create project structure
mkdir -p kpi-system/{backend,frontend,data,scripts}
cd kpi-system

# 2. Initialize backend
cd backend
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install fastapi uvicorn sqlalchemy alembic
fastapi dev app/main.py

# 3. Initialize frontend
cd ../frontend
npm create vite@latest . -- --template react
npm install
npm install -D tailwindcss postcss autoprefixer
npm run dev

# 4. Docker deployment
docker-compose up -d

# 5. Initialize database
docker-compose exec backend python scripts/init_db.py

# 6. Create admin user
docker-compose exec backend python scripts/create_admin.py

# Access application
http://localhost        # Frontend
http://localhost:8000   # Backend API
http://localhost:8000/docs  # API Documentation

================================================================================
END OF PROMPT
================================================================================
